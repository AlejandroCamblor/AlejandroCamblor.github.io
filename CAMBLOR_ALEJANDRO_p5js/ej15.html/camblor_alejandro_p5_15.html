<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>A1 — Mi escena con variables</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  </head>
  <body>
    <script>
      // A1 — Reutilización: añade movimiento con variables (sin condicionales)

      let x_s, y_s, v_s, d_s, r_s;
      let x_l, y_l, v_l, d_l, r_l;
      let dia, mes, anio;
      let x_p, y_p, S, v_p, ground_y, v_y, jump_v, g;
      let rHead, bodyL, armL, legL;
      let hipY, shoulderY, headY;
      let xD, yD, vyD, tD;
      let disparoActivo; // ✅ CORRECCIÓN

      function setup() {
        createCanvas(600, 600);

        d_s = min(width, height) * 0.2;
        r_s = d_s / 2;
        d_l = d_s * 0.5;
        r_l = d_l / 2;

        x_s = -r_s;
        y_s = height * 0.4;
        x_l = -width - d_s;
        y_l = height * 0.3;

        v_s = width / 400;
        v_l = v_s;

        dia = 1;
        mes = 1;
        anio = 2026;

        S = 0.12 * min(width, height);
        ground_y = 0.9 * height;
        x_p = 0.25 * width;
        y_p = ground_y;

        v_p = width / 150;
        v_y = 1;
        jump_v = -0.030 * height;
        g = 0.0016 * height;

        rHead = 0.20 * S;
        bodyL = 0.60 * S;
        armL  = 0.45 * S;
        legL  = 0.55 * S;

        hipY = y_p - legL;
        shoulderY = hipY - bodyL;
        headY = shoulderY - rHead;

        disparoActivo = false;
        xD = x_p;
        yD = y_p;
        vyD = width * 0.01;
        tD = 0.01 * min(width, height);
      }

      function draw() {
        if (x_s <= width + r_s) background(135, 206, 235);
        else background(10);

        noStroke();
        fill(x_s <= width + r_s ? 0 : 255);
        textSize(10);
        text("Fecha: (" + dia + ") (" + mes + ") (" + anio + ")", 0, 10);

        fill(34, 139, 34);
        rect(0, height * 0.9, width, height * 0.2);

        fill(255, 204, 0);
        ellipse(x_s, y_s, d_s);

        fill(245);
        ellipse(x_l, y_l, d_l);

        dibujarStickman();

        x_s = x_s + v_s;
        x_l = x_l + v_l;

        dibujarCalendario();

        v_y = v_y + g;
        y_p = y_p + v_y;

        if (y_p > ground_y) {
          y_p = ground_y;
          v_y = 0;
        }

        hipY = y_p - legL;
        shoulderY = hipY - bodyL;
        headY = shoulderY - rHead;

        if (keyIsDown(LEFT_ARROW)) x_p = x_p - v_p;
        else if (keyIsDown(RIGHT_ARROW)) x_p = x_p + v_p;

        if (x_p < 0) x_p = 0;
        if (x_p > width) x_p = width;

        dibujarDisparo();
      }

      function keyPressed() {
        if (keyCode === UP_ARROW && y_p >= ground_y) {
          v_y = jump_v;
        }
        if (key === ' ') { // ✅ CORRECCIÓN
          disparoActivo = true;
          xD = x_p;
          yD = y_p;
        }
      }

      function dibujarStickman() {
        stroke(x_s <= width + r_s ? 0 : 255);
        strokeWeight(0.06 * S);
        noFill();

        circle(x_p, headY, 2 * rHead);
        line(x_p, shoulderY, x_p, hipY);

        line(x_p - 0.25 * S, shoulderY, x_p + 0.25 * S, shoulderY);
        line(x_p - 0.25 * S, shoulderY, x_p - 0.25 * S, shoulderY + armL);
        line(x_p + 0.25 * S, shoulderY, x_p + 0.25 * S, shoulderY + armL);

        line(x_p, hipY, x_p - 0.18 * S, y_p);
        line(x_p, hipY, x_p + 0.18 * S, y_p);
      }

      function dibujarCalendario() {
        if (x_s >= 2 * width + d_l) {
          x_s = -r_s;
          x_l = -width - d_s;

          dia = dia + 1;
          if (dia > 30) {
            dia = 1;
            mes = mes + 1;
          }
          if (mes > 12) {
            mes = 1;
            anio = anio + 1;
          }
        }
      }

      function dibujarDisparo() { // ✅ CORRECCIÓN COMPLETA
        if (disparoActivo) {
          stroke(220, 255, 0);
          strokeWeight(0.05 * S);

          line(xD, yD - tD, xD, yD + tD); // vertical
          line(xD - tD, yD, xD + tD, yD); // horizontal

          yD = yD - vyD;

          if (yD < 0) {
            disparoActivo = false;
          }
        }
      }
    </script>
  </body>
</html>